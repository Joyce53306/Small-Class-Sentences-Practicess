<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>English Speaking L1-L10</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #4ECDC4;
            --accent: #FF6B6B;
            --yellow: #FFE66D;
            --blue: #54a0ff; /* æ–°å¢è—è‰²çµ¦æ’­æ”¾éµ */
            --bg: #F7FFF7;
            --text: #2D3436;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* é ‚éƒ¨é¸å–®å€ */
        .header {
            background: white;
            padding: 15px 0 15px 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            z-index: 10;
        }

        .app-title {
            text-align: center;
            color: var(--accent);
            font-size: 1.1rem;
            margin: 0 0 12px 0;
            font-weight: 600;
        }

        .nav-scroller {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 5px;
            padding-right: 15px;
            scrollbar-width: none;
        }
        .nav-scroller::-webkit-scrollbar { display: none; }

        .nav-btn {
            background: #f1f3f5;
            border: none;
            padding: 8px 18px;
            border-radius: 20px;
            white-space: nowrap;
            color: #868e96;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(78, 205, 196, 0.4);
        }

        /* å…§å®¹å€ */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 80px;
            -webkit-overflow-scrolling: touch;
        }

        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background: white;
            border-radius: 25px;
            padding: 30px 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            text-align: center;
            border: 1px solid #f0f0f0;
        }

        .sentence {
            font-size: 1.5rem;
            color: var(--text);
            font-weight: 600;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        /* æŒ‰éˆ•å€å¡Šï¼šç¢ºä¿æŒ‰éˆ•ç½®ä¸­æ’åˆ— */
        .btn-group {
            display: flex;
            justify-content: center;
            gap: 20px; /* æŒ‰éˆ•ä¹‹é–“çš„è·é›¢ */
            align-items: center;
            min-height: 80px; /* é ç•™é«˜åº¦é¿å…è·³å‹• */
        }

        /* é€šç”¨åœ“å½¢æŒ‰éˆ• */
        .action-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            font-size: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s, opacity 0.2s;
            box-shadow: 0 6px 0 rgba(0,0,0,0.1);
        }

        .action-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* é»ƒè‰²ï¼šè€å¸«å”¸ */
        .speak-btn {
            background: var(--yellow);
            color: #555;
        }

        /* ç´…è‰²ï¼šéŒ„éŸ³ */
        .rec-btn {
            background: var(--accent);
            color: white;
        }
        
        /* éŒ„éŸ³ä¸­ï¼šé–ƒçˆå‹•ç•« */
        .rec-btn.recording {
            background: #333;
            animation: pulse 1.5s infinite;
        }

        /* è—è‰²ï¼šæ’­æ”¾éŒ„éŸ³ (é è¨­éš±è—) */
        .play-btn {
            background: var(--blue);
            color: white;
            display: none; /* ä¸€é–‹å§‹ä¸é¡¯ç¤º */
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

    </style>
</head>
<body>

    <div class="header">
        <h1 class="app-title">ğŸŒŸ English Speaking L1-L10</h1>
        <div class="nav-scroller" id="navScroller">
            </div>
    </div>

    <div class="content-area" id="contentArea">
        </div>

<script>
    // --- 1. èª²ç¨‹è³‡æ–™ (ä¿®æ­£äº†éƒ¨åˆ†æ‹¼å­—éŒ¯èª¤) ---
    const lessons = {
        "L1 I Can Move": [
            "I can move.", "I can swing.", "I can walk.", "I can swim.",
            "I can run.", "I can play.", "I can jump.", "I can climb.",
            "I can dance.", "I can sleep."
        ],
        "L2 What Am I?": [
            "Is it a snake?", "Is it a fox?", "Is it a fish?", "Is it a bear?",
            "Is it a rabbit?", "Is it a spider?", "Is it a cat?", "Is it a mouse?",
            "Yes, it is.", "No, it is not."
        ],
        "L3 Look at Me!": [
            "Look at me. I am a monkey.", "Look at me. I am a bird.",
            "Look at me. I am a pig.", "Look at me. I am a turtle.",
            "Look at me. I am a dog.", "Look at me. I am a frog.",
            "Look at me. I am a lion.", "Look at me. I am a butterfly.",
            "Look at me. I am an alligator.", "Look at me. I am an elephant."
        ],
        "L4 Shake Shake": [
            "Hand, hand, shake, shake.", "Head, head, shake, shake.",
            "Shoulder, shoulder, shake, shake.", "Tummy, tummy, shake, shake.",
            "Knee, knee, shake, shake.", "Foot, foot, shake, shake.",
            "Tongue, tongue, shake, shake.", "Ear, ear, shake, shake.",
            "Hip, hip, shake, shake.", "Elbow, elbow, shake, shake."
        ],
        "L5 What Color": [
            "The sun is yellow.", "The sky is blue.", "The grass is green.",
            "The apple is red.", "The flower is purple.",
            "The leaves are green.", "The tree trunk is brown."
        ],
        "L6 Count with Me": [
            "One, one! Show your thumb.", "Two, two! Touch your shoe.",
            "Three, three! Pat your knee.", "Four, four! Shut the door.",
            "Five, five! You can drive.", "Six, six! Letâ€™s mix.",
            "Seven, seven! Look at heaven.", "Eight, eight! Stand up straight.",
            "Nine, nine! Take a dive.", "Ten, ten! You can bend."
        ],
        "L7 How Many": [
            "How many eyes do you have?", "I have two eyes.",
            "How many noses do you have?", "I have one nose.",
            "How many ears do you have?", "I have two ears.",
            "How many mouths do you have?", "I have one mouth."
        ],
        "L8 Be Like You": [
            "May I use your tie? So I can go to work.",
            "May I use your hammer? So I can build a house.",
            "May I use your rod? So I can go fishing?",
            "May I use your car? So I can drive.",
            "May I use your shoes? I want to be like you."
        ],
        "L9 Alien": [
            "I like to go swimming.", "I like to go shopping.",
            "I like to go to the hospital.", "I like to go to the zoo.",
            "I like to go to the playground.", "I like to go to the movies.",
            "I like to go to the beach.", "I like to go to the museum.",
            "I like to go to school."
        ],
        "L10 Super Mom": [
            "She is smart. She can do math.", "She is strong. She can carry ten bags.",
            "She is fast. She can run.", "She sees everything.",
            "She can find my socks.", "She can fix anything.",
            "She can sew my shirt."
        ]
    };

    let currentLesson = Object.keys(lessons)[0];
    let mediaRecorders = {}; 
    let audioChunks = {};
    let audioBlobs = {};

    function init() {
        renderNav();
        renderCards(currentLesson);
    }

    // --- 2. ä»‹é¢ï¼šæ©«å‘é¸å–® ---
    function renderNav() {
        const nav = document.getElementById('navScroller');
        nav.innerHTML = '';
        Object.keys(lessons).forEach((lessonName) => {
            const btn = document.createElement('button');
            const shortTitle = lessonName.split(' ')[0] + ' ' + lessonName.split(' ')[1];
            btn.className = `nav-btn ${lessonName === currentLesson ? 'active' : ''}`;
            btn.innerText = shortTitle;
            btn.onclick = () => {
                currentLesson = lessonName;
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderCards(lessonName);
            };
            nav.appendChild(btn);
        });
    }

    // --- 3. ä»‹é¢ï¼šå¡ç‰‡æ¸²æŸ“ ---
    function renderCards(lessonName) {
        const container = document.getElementById('contentArea');
        container.innerHTML = '';
        
        // é‡ç½®ç‹€æ…‹
        mediaRecorders = {};
        audioChunks = {};
        audioBlobs = {};

        lessons[lessonName].forEach((sentence, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            
            // æ³¨æ„ï¼šé€™è£¡æ–°å¢äº†ä¸€å€‹ class ç‚º play-btn çš„æŒ‰éˆ•ï¼Œé è¨­æ˜¯éš±è—çš„
            card.innerHTML = `
                <div class="sentence">${sentence}</div>
                <div class="btn-group">
                    <button class="action-btn speak-btn" onclick="speak('${sentence.replace(/'/g, "\\'")}')">ğŸ”Š</button>
                    <button class="action-btn rec-btn" id="rec-btn-${index}" onclick="toggleRecord(${index})">ğŸ¤</button>
                    <button class="action-btn play-btn" id="play-btn-${index}" onclick="playMyVoice(${index})">â–¶ï¸</button>
                </div>
            `;
            container.appendChild(card);
        });
    }

    // --- 4. è€å¸«å”¸ (TTS) ---
    function speak(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'en-US'; 
        msg.rate = 0.85; 
        window.speechSynthesis.speak(msg);
    }

    // --- 5. è·¨å¹³å°éŒ„éŸ³èˆ‡æ’­æ”¾é‚è¼¯ ---
    async function toggleRecord(index) {
        const recBtn = document.getElementById(`rec-btn-${index}`);
        const playBtn = document.getElementById(`play-btn-${index}`);

        // A. åœæ­¢éŒ„éŸ³
        if (recBtn.classList.contains('recording')) {
            if (mediaRecorders[index] && mediaRecorders[index].state !== 'inactive') {
                mediaRecorders[index].stop();
            }
            recBtn.classList.remove('recording');
            recBtn.innerHTML = 'ğŸ¤'; 
            return;
        }

        // B. é–‹å§‹éŒ„éŸ³
        try {
            // æ¯æ¬¡é‡æ–°éŒ„éŸ³æ™‚ï¼Œéš±è—æ’­æ”¾éµï¼Œä¸¦æ¸…ç©ºèˆŠçš„éŒ„éŸ³
            playBtn.style.display = 'none';
            
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            
            // iOS æ”¯æ´ mp4, Android/Chrome æ”¯æ´ webm
            let mimeType = 'audio/webm';
            if (!MediaRecorder.isTypeSupported('audio/webm')) {
                mimeType = 'audio/mp4'; 
            }

            const recorder = new MediaRecorder(stream, { mimeType: mimeType });
            mediaRecorders[index] = recorder;
            audioChunks[index] = [];

            recorder.ondataavailable = (e) => {
                if (e.data.size > 0) {
                    audioChunks[index].push(e.data);
                }
            };

            recorder.onstop = () => {
                const blob = new Blob(audioChunks[index], { type: mimeType });
                const audioUrl = URL.createObjectURL(blob);
                audioBlobs[index] = audioUrl;
                
                // éŒ„éŸ³å®Œæˆå¾Œï¼šé¡¯ç¤ºè—è‰²åœ“å½¢æ’­æ”¾éµ
                playBtn.style.display = 'flex';
                
                // é‡‹æ”¾éº¥å…‹é¢¨
                stream.getTracks().forEach(track => track.stop());
            };

            recorder.start();
            recBtn.classList.add('recording');
            recBtn.innerHTML = 'â¬›'; // åœæ­¢ç¬¦è™Ÿ
            
        } catch (err) {
            console.error("Mic Error:", err);
            alert('ç„¡æ³•é–‹å•Ÿéº¥å…‹é¢¨ã€‚è«‹ç¢ºèªï¼š\n1. å…è¨±éº¥å…‹é¢¨æ¬Šé™\n2. iOS è«‹ç”¨ Safari\n3. ç¶²å€ç‚º HTTPS');
        }
    }

    // --- 6. æ’­æ”¾éŒ„éŸ³ (ä¸€æ¬¡æ€§ï¼Œä¸å„²å­˜) ---
    function playMyVoice(index) {
        if (audioBlobs[index]) {
            const audio = new Audio(audioBlobs[index]);
            audio.play();
        }
    }

    init();

</script>
</body>
</html>
