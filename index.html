<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>English Speaking L1-L10</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #4ECDC4;  /* æ¸…æ–°ç¶  */
            --accent: #FF6B6B;   /* æ´»æ½‘ç´… */
            --yellow: #FFE66D;   /* äº®çœ¼é»ƒ */
            --bg: #F7FFF7;       /* æ·ºç™½åº• */
            --text: #2D3436;     /* æ·±ç°å­— */
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; /* ç§»é™¤é»æ“Šè—æ¡† */
            user-select: none; /* ç¦æ­¢é•·æŒ‰é¸å–æ–‡å­— */
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden; /* å›ºå®šé é¢ï¼Œåªè®“å…§å®¹å€æ²å‹• */
        }

        /* é ‚éƒ¨å°èˆªå€ */
        .header {
            background: white;
            padding: 15px 0 15px 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            z-index: 10;
        }

        .app-title {
            text-align: center;
            color: var(--accent);
            font-size: 1.1rem;
            margin: 0 0 12px 0;
            font-weight: 600;
        }

        /* æ©«å‘æ²å‹•é¸å–® (L1, L2...) */
        .nav-scroller {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 5px;
            padding-right: 15px;
            scrollbar-width: none;
        }
        .nav-scroller::-webkit-scrollbar { display: none; }

        .nav-btn {
            background: #f1f3f5;
            border: none;
            padding: 8px 18px;
            border-radius: 20px;
            white-space: nowrap;
            color: #868e96;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(78, 205, 196, 0.4);
        }

        /* å…§å®¹æ²å‹•å€ */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 80px;
            -webkit-overflow-scrolling: touch; /* iOS æ»‘å‹•é †æš¢ */
        }

        /* å¥å­å¡ç‰‡è¨­è¨ˆ */
        .card {
            background: white;
            border-radius: 25px;
            padding: 30px 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            text-align: center;
            border: 1px solid #f0f0f0;
        }

        .sentence {
            font-size: 1.5rem;
            color: var(--text);
            font-weight: 600;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        /* æŒ‰éˆ•ç¾¤çµ„ */
        .btn-group {
            display: flex;
            justify-content: center;
            gap: 30px;
            align-items: center;
        }

        /* åœ“å½¢æŒ‰éˆ•å…±ç”¨æ¨£å¼ */
        .action-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            font-size: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s;
            box-shadow: 0 6px 0 rgba(0,0,0,0.1); /* ç«‹é«”æ„Ÿ */
        }

        .action-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* å–‡å­æŒ‰éˆ• (é»ƒ) */
        .speak-btn {
            background: var(--yellow);
            color: #555;
        }

        /* éº¥å…‹é¢¨æŒ‰éˆ• (ç´…) */
        .rec-btn {
            background: var(--accent);
            color: white;
        }
        
        /* éŒ„éŸ³ä¸­ç‹€æ…‹ */
        .rec-btn.recording {
            background: #333;
            animation: pulse 1.5s infinite;
        }

        /* æ’­æ”¾æˆ‘çš„éŒ„éŸ³æŒ‰éˆ• (ç¶ é•·æ¢) */
        .play-my-voice-btn {
            background: #51cf66;
            color: white;
            width: 80%;
            border-radius: 50px;
            padding: 12px;
            margin: 20px auto 0 auto;
            border: none;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            display: none; /* é è¨­éš±è— */
            box-shadow: 0 4px 10px rgba(81, 207, 102, 0.3);
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

    </style>
</head>
<body>

    <div class="header">
        <h1 class="app-title">ğŸŒŸ è‹±èªå£èªªæŒ‘æˆ° (L1-L10)</h1>
        <div class="nav-scroller" id="navScroller">
            </div>
    </div>

    <div class="content-area" id="contentArea">
        </div>

<script>
    // --- 1. èª²ç¨‹è³‡æ–™åº« (L1-L10) ---
    // å·²æ ¹æ“šæ‚¨çš„åœ–ç‰‡æ–‡å­—é€²è¡Œæ•´ç†
    const lessons = {
        "L1 I Can Move": [
            "I can move.", "I can swing.", "I can walk.", "I can swim.",
            "I can run.", "I can play.", "I can jump.", "I can climb.",
            "I can dance.", "I can sleep."
        ],
        "L2 What Am I?": [
            "Is it a snake?", "Is it a fox?", "Is it a fish?", "Is it a bear?",
            "Is it a rabbit?", "Is it a spider?", "Is it a cat?", "Is it a mouse?",
            "Yes, it is.", "No, it is not."
        ],
        "L3 Look at Me!": [
            "Look at me. I am a monkey.", "Look at me. I am a bird.",
            "Look at me. I am a pig.", "Look at me. I am a turtle.",
            "Look at me. I am a dog.", "Look at me. I am a frog.",
            "Look at me. I am a lion.", "Look at me. I am a butterfly.",
            "Look at me. I am an alligator.", "Look at me. I am an elephant."
        ],
        "L4 Shake Shake": [
            "Hand, hand, shake, shake.", "Head, head, shake, shake.",
            "Shoulder, shoulder, shake, shake.", "Tummy, tummy, shake, shake.",
            "Knee, knee, shake, shake.", "Foot, foot, shake, shake.",
            "Tongue, tongue, shake, shake.", "Ear, ear, shake, shake.",
            "Hip, hip, shake, shake.", "Elbow, elbow, shake, shake."
        ],
        "L5 What Color": [
            "The sun is yellow.", "The sky is blue.", "The grass is green.",
            "The apple is red.", "The flower is purple.",
            "The leaves are green.", "The tree trunk is brown."
        ],
        "L6 Count with Me": [
            "One, one! Show your thumb.", "Two, two! Touch your shoe.",
            "Three, three! Pat your knee.", "Four, four! Shut the door.",
            "Five, five! You can drive.", "Six, six! Letâ€™s mix.",
            "Seven, seven! Look at heaven.", "Eight, eight! Stand up straight.",
            "Nine, nine! Take a dive.", "Ten, ten! You can bend."
        ],
        "L7 How Many": [
            "How many eyes do you have?", "I have two eyes.",
            "How many noses do you have?", "I have one nose.",
            "How many ears do you have?", "I have two ears.",
            "How many mouths do you have?", "I have one mouth."
        ],
        "L8 Be Like You": [
            "May I use your tie? So I can go to work.",
            "May I use your hammer? So I can build a house.",
            "May I use your rod? So I can go fishing?",
            "May I use your car? So I can drive.",
            "May I use your shoes? I want to be like you."
        ],
        "L9 Alien": [
            "I like to go swimming.", "I like to go shopping.",
            "I like to go to the hospital.", "I like to go to the zoo.",
            "I like to go to the playground.", "I like to go to the movies.",
            "I like to go to the beach.", "I like to go to the museum.",
            "I like to go to school."
        ],
        "L10 Super Mom": [
            "She is smart. She can do math.", "She is strong. She can carry ten bags.",
            "She is fast. She can run.", "She sees everything.",
            "She can find my socks.", "She can fix anything.",
            "She can sew my shirt."
        ]
    };

    let currentLesson = Object.keys(lessons)[0];
    let mediaRecorders = {}; 
    let audioChunks = {};
    let audioBlobs = {};

    // --- åˆå§‹åŒ– ---
    function init() {
        renderNav();
        renderCards(currentLesson);
    }

    // --- 2. ä»‹é¢æ¸²æŸ“ï¼šæ©«å‘é¸å–® ---
    function renderNav() {
        const nav = document.getElementById('navScroller');
        nav.innerHTML = '';
        Object.keys(lessons).forEach((lessonName) => {
            const btn = document.createElement('button');
            // æå–ç°¡çŸ­æ¨™é¡Œ (ä¾‹å¦‚ "L1 I Can Move" -> "L1")
            const shortTitle = lessonName.split(' ')[0] + ' ' + lessonName.split(' ').slice(1,3).join(' ');
            
            btn.className = `nav-btn ${lessonName === currentLesson ? 'active' : ''}`;
            btn.innerText = shortTitle;
            btn.onclick = () => {
                currentLesson = lessonName;
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderCards(lessonName);
            };
            nav.appendChild(btn);
        });
    }

    // --- 3. ä»‹é¢æ¸²æŸ“ï¼šå¥å­å¡ç‰‡ ---
    function renderCards(lessonName) {
        const container = document.getElementById('contentArea');
        container.innerHTML = '';
        
        // åˆ‡æ›èª²ç¨‹æ™‚ï¼Œé‡ç½®éŒ„éŸ³ç‹€æ…‹
        mediaRecorders = {};
        audioChunks = {};
        audioBlobs = {};

        lessons[lessonName].forEach((sentence, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            
            // å»ºç«‹å¡ç‰‡ HTML
            card.innerHTML = `
                <div class="sentence">${sentence}</div>
                <div class="btn-group">
                    <button class="action-btn speak-btn" onclick="speak('${sentence.replace(/'/g, "\\'")}')">ğŸ”Š</button>
                    <button class="action-btn rec-btn" id="rec-btn-${index}" onclick="toggleRecord(${index})">ğŸ¤</button>
                </div>
                <button class="play-my-voice-btn" id="play-btn-${index}" onclick="playMyVoice(${index})">
                    â–¶ï¸ æ’­æ”¾æˆ‘çš„éŒ„éŸ³
                </button>
            `;
            container.appendChild(card);
        });
    }

    // --- 4. è€å¸«å”¸ (TTS) ---
    function speak(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'en-US'; 
        msg.rate = 0.85; // ç¨å¾®æ”¾æ…¢èªé€Ÿé©åˆå­¸ç¿’
        window.speechSynthesis.speak(msg);
    }

    // --- 5. è·¨å¹³å°éŒ„éŸ³åŠŸèƒ½ (iOS/Android) ---
    async function toggleRecord(index) {
        const btn = document.getElementById(`rec-btn-${index}`);
        const playBtn = document.getElementById(`play-btn-${index}`);

        // A. åœæ­¢éŒ„éŸ³
        if (btn.classList.contains('recording')) {
            if (mediaRecorders[index] && mediaRecorders[index].state !== 'inactive') {
                mediaRecorders[index].stop();
            }
            btn.classList.remove('recording');
            btn.innerHTML = 'ğŸ¤'; // è®Šå›éº¥å…‹é¢¨
            return;
        }

        // B. é–‹å§‹éŒ„éŸ³
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            
            // é—œéµï¼šiOS Safari éœ€è¦ mp4ï¼ŒChrome/Android æ”¯æ´ webm
            let mimeType = 'audio/webm';
            if (!MediaRecorder.isTypeSupported('audio/webm')) {
                mimeType = 'audio/mp4'; // iOS Fallback
            }

            const recorder = new MediaRecorder(stream, { mimeType: mimeType });
            mediaRecorders[index] = recorder;
            audioChunks[index] = [];

            recorder.ondataavailable = (e) => {
                if (e.data.size > 0) {
                    audioChunks[index].push(e.data);
                }
            };

            recorder.onstop = () => {
                // å»ºç«‹æš«æ™‚çš„æ’­æ”¾é€£çµ (ä¸å„²å­˜åˆ°ä¼ºæœå™¨)
                const blob = new Blob(audioChunks[index], { type: mimeType });
                const audioUrl = URL.createObjectURL(blob);
                audioBlobs[index] = audioUrl;
                
                // é¡¯ç¤ºæ’­æ”¾æŒ‰éˆ•
                playBtn.style.display = 'flex';
                
                // é‡‹æ”¾éº¥å…‹é¢¨
                stream.getTracks().forEach(track => track.stop());
            };

            recorder.start();
            btn.classList.add('recording');
            btn.innerHTML = 'â¬›'; // é¡¯ç¤ºåœæ­¢åœ–ç¤º
            playBtn.style.display = 'none'; // éŒ„éŸ³æ™‚éš±è—èˆŠçš„æ’­æ”¾éµ

        } catch (err) {
            console.error("Microphone Error:", err);
            alert('ç„¡æ³•é–‹å•Ÿéº¥å…‹é¢¨ã€‚è«‹ç¢ºèªï¼š\n1. å…è¨±éº¥å…‹é¢¨æ¬Šé™\n2. è‹¥æ˜¯ iPhone è«‹ç”¨ Safari é–‹å•Ÿ\n3. ç¶²å€å¿…é ˆæ˜¯ HTTPS');
        }
    }

    // --- 6. æ’­æ”¾éŒ„éŸ³ ---
    function playMyVoice(index) {
        if (audioBlobs[index]) {
            const audio = new Audio(audioBlobs[index]);
            audio.play();
        }
    }

    // å•Ÿå‹•ç¨‹å¼
    init();

</script>
</body>
</html>
