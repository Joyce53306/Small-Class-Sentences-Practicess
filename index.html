<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Little English Hero</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">

    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #4ECDC4;
            --accent: #FF6B6B;
            --yellow: #FFE66D;
            --bg: #F7FFF7;
            --text: #2D3436;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden; /* é˜²æ­¢æ•´é«”é é¢æ²å‹• */
        }

        /* é ‚éƒ¨å°èˆªå€ */
        .header {
            background: white;
            padding: 15px 0 15px 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            z-index: 10;
        }

        .app-title {
            text-align: center;
            color: var(--accent);
            font-size: 1.2rem;
            margin: 0 0 10px 0;
            font-weight: 600;
        }

        /* æ©«å‘æ²å‹•é¸å–® */
        .nav-scroller {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 5px;
            scrollbar-width: none; /* Firefox éš±è—æ²è»¸ */
        }
        .nav-scroller::-webkit-scrollbar { display: none; } /* Chrome éš±è—æ²è»¸ */

        .nav-btn {
            background: #f1f3f5;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            white-space: nowrap;
            color: #868e96;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(78, 205, 196, 0.4);
        }

        /* å…§å®¹æ²å‹•å€ */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 80px; /* é ç•™åº•éƒ¨ç©ºé–“ */
        }

        /* å¥å­å¡ç‰‡ */
        .card {
            background: white;
            border-radius: 25px;
            padding: 25px 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            text-align: center;
            border: 1px solid #f0f0f0;
        }

        .sentence {
            font-size: 1.4rem;
            color: var(--text);
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        /* æŒ‰éˆ•ç¾¤çµ„ */
        .btn-group {
            display: flex;
            justify-content: center;
            gap: 25px;
            align-items: flex-start;
        }

        .action-btn {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            border: none;
            font-size: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s;
            box-shadow: 0 6px 0 rgba(0,0,0,0.1);
        }

        .action-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .speak-btn {
            background: var(--yellow);
            color: #5f5f5f;
        }

        .rec-btn {
            background: var(--accent);
            color: white;
        }
        
        .rec-btn.recording {
            background: #333;
            animation: pulse 1.5s infinite;
        }

        .play-my-voice-btn {
            background: #51cf66;
            color: white;
            width: 100%;
            border-radius: 15px;
            padding: 10px;
            margin-top: 15px;
            border: none;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            display: none; /* é è¨­éš±è—ï¼ŒéŒ„éŸ³å®Œæ‰é¡¯ç¤º */
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* æç¤ºå­— */
        .hint {
            font-size: 0.8rem;
            color: #ccc;
            margin-top: 5px;
            display: block;
        }

    </style>
</head>
<body>

    <div class="header">
        <h1 class="app-title">ğŸŒŸ Little English Hero (L1-L10)</h1>
        <div class="nav-scroller" id="navScroller">
            </div>
    </div>

    <div class="content-area" id="contentArea">
        </div>

<script>
    // --- èª²ç¨‹è³‡æ–™åº« ---
    const lessons = {
        "L1 I Can Move": [
            "I can move.", "I can swing.", "I can walk.", "I can swim.",
            "I can run.", "I can play.", "I can jump.", "I can climb.",
            "I can dance.", "I can sleep."
        ],
        "L2 What Am I?": [
            "Is it a snake?", "Is it a fox?", "Is it a fish?", "Is it a bear?",
            "Is it a rabbit?", "Is it a spider?", "Is it a cat?", "Is it a mouse?",
            "Yes, it is.", "No, it is not."
        ],
        "L3 Look at Me!": [
            "Look at me. I am a monkey.", "Look at me. I am a bird.",
            "Look at me. I am a pig.", "Look at me. I am a turtle.",
            "Look at me. I am a dog.", "Look at me. I am a frog.",
            "Look at me. I am a lion.", "Look at me. I am a butterfly.",
            "Look at me. I am an alligator.", "Look at me. I am an elephant."
        ],
        "L4 Shake Shake": [
            "Hand, hand, shake, shake.", "Head, head, shake, shake.",
            "Shoulder, shoulder, shake, shake.", "Tummy, tummy, shake, shake.",
            "Knee, knee, shake, shake.", "Foot, foot, shake, shake.",
            "Tongue, tongue, shake, shake.", "Ear, ear, shake, shake.",
            "Hip, hip, shake, shake.", "Elbow, elbow, shake, shake."
        ],
        "L5 What Color": [
            "The sun is yellow.", "The sky is blue.", "The grass is green.",
            "The apple is red.", "The flower is purple.",
            "The leaves are green.", "The tree trunk is brown."
        ],
        "L6 Count with Me": [
            "One, one! Show your thumb.", "Two, two! Touch your shoe.",
            "Three, three! Pat your knee.", "Four, four! Shut the door.",
            "Five, five! You can drive.", "Six, six! Letâ€™s mix.",
            "Seven, seven! Look at heaven.", "Eight, eight! Stand up straight.",
            "Nine, nine! Take a dive.", "Ten, ten! You can bend."
        ],
        "L7 How Many": [
            "How many eyes do you have?", "I have two eyes.",
            "How many noses do you have?", "I have one nose.",
            "How many ears do you have?", "I have two ears.",
            "How many mouths do you have?", "I have one mouth."
        ],
        "L8 Be Like You": [
            "May I use your tie? So I can go to work.",
            "May I use your hammer? So I can build a house.",
            "May I use your rod? So I can go fishing?",
            "May I use your car? So I can drive.",
            "May I use your shoes? I want to be like you."
        ],
        "L9 Alien": [
            "I like to go swimming.", "I like to go shopping.",
            "I like to go to the hospital.", "I like to go to the zoo.",
            "I like to go to the playground.", "I like to go to the movies.",
            "I like to go to the beach.", "I like to go to the museum.",
            "I like to go to school."
        ],
        "L10 Super Mom": [
            "She is smart. She can do math.", "She is strong. She can carry ten bags.",
            "She is fat. She can run.", "She sees everything.",
            "She can find my socks.", "She can fix anything.",
            "She can sew my shirt."
        ]
    };

    let currentLesson = Object.keys(lessons)[0];
    let mediaRecorders = {}; // å„²å­˜æ¯å€‹å¡ç‰‡çš„éŒ„éŸ³å™¨
    let audioChunks = {};    // å„²å­˜éŒ„éŸ³ç‰‡æ®µ
    let audioBlobs = {};     // å„²å­˜éŒ„éŸ³æª”

    // --- åˆå§‹åŒ– ---
    function init() {
        renderNav();
        renderCards(currentLesson);
    }

    // --- æ¸²æŸ“é¸å–® ---
    function renderNav() {
        const nav = document.getElementById('navScroller');
        nav.innerHTML = '';
        Object.keys(lessons).forEach((lessonName, index) => {
            const btn = document.createElement('button');
            btn.className = `nav-btn ${lessonName === currentLesson ? 'active' : ''}`;
            btn.innerText = lessonName.split(' ')[0] + ' ' + lessonName.split(' ')[1]; // ç°¡çŸ­é¡¯ç¤º
            btn.onclick = () => {
                currentLesson = lessonName;
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderCards(lessonName);
            };
            nav.appendChild(btn);
        });
    }

    // --- æ¸²æŸ“å¡ç‰‡ ---
    function renderCards(lessonName) {
        const container = document.getElementById('contentArea');
        container.innerHTML = '';
        // é‡ç½®éŒ„éŸ³ç‹€æ…‹
        mediaRecorders = {};
        audioChunks = {};
        audioBlobs = {};

        lessons[lessonName].forEach((sentence, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="sentence">${sentence}</div>
                <div class="btn-group">
                    <div>
                        <button class="action-btn speak-btn" onclick="speak('${sentence.replace(/'/g, "\\'")}')">ğŸ”Š</button>
                    </div>
                    <div>
                        <button class="action-btn rec-btn" id="rec-btn-${index}" onclick="toggleRecord(${index})">ğŸ¤</button>
                    </div>
                </div>
                <button class="play-my-voice-btn" id="play-btn-${index}" onclick="playMyVoice(${index})">â–¶ï¸ æ’­æˆ‘çš„éŒ„éŸ³</button>
            `;
            container.appendChild(card);
        });
    }

    // --- è€å¸«å”¸ (TTS) ---
    function speak(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'en-US';
        msg.rate = 0.8; // ç¨å¾®æ”¾æ…¢èªé€Ÿ
        window.speechSynthesis.speak(msg);
    }

    // --- éŒ„éŸ³åŠŸèƒ½ ---
    async function toggleRecord(index) {
        const btn = document.getElementById(`rec-btn-${index}`);
        const playBtn = document.getElementById(`play-btn-${index}`);

        // å¦‚æœæ­£åœ¨éŒ„éŸ³ -> åœæ­¢
        if (btn.classList.contains('recording')) {
            mediaRecorders[index].stop();
            btn.classList.remove('recording');
            btn.innerText = 'ğŸ¤';
            return;
        }

        // å¦‚æœæ²’åœ¨éŒ„éŸ³ -> é–‹å§‹
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            
            // iOS æ”¯æ´æ ¼å¼æª¢æŸ¥
            let mimeType = 'audio/webm';
            if (!MediaRecorder.isTypeSupported('audio/webm')) {
                mimeType = 'audio/mp4'; // iOS Safari å¸¸ç”¨
            }

            const recorder = new MediaRecorder(stream, { mimeType: mimeType });
            mediaRecorders[index] = recorder;
            audioChunks[index] = [];

            recorder.ondataavailable = (e) => {
                audioChunks[index].push(e.data);
            };

            recorder.onstop = () => {
                const blob = new Blob(audioChunks[index], { type: mimeType });
                audioBlobs[index] = URL.createObjectURL(blob);
                playBtn.style.display = 'block'; // é¡¯ç¤ºæ’­æ”¾æŒ‰éˆ•
                
                // åœæ­¢éº¥å…‹é¢¨ä½¿ç”¨
                stream.getTracks().forEach(track => track.stop());
            };

            recorder.start();
            btn.classList.add('recording');
            btn.innerText = 'â¹'; // åœæ­¢ç¬¦è™Ÿ
            playBtn.style.display = 'none'; // éŒ„éŸ³æ™‚éš±è—æ’­æ”¾éµ

        } catch (err) {
            console.error(err);
            alert('ç„¡æ³•å­˜å–éº¥å…‹é¢¨ï¼Œè«‹ç¢ºèªæ¬Šé™æˆ–ä½¿ç”¨ Safari/Chrome é–‹å•Ÿã€‚');
        }
    }

    // --- æ’­æˆ‘çš„éŒ„éŸ³ ---
    function playMyVoice(index) {
        if (audioBlobs[index]) {
            const audio = new Audio(audioBlobs[index]);
            audio.play();
        }
    }

    // å•Ÿå‹•
    init();

</script>
</body>
</html>
